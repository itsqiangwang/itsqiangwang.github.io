<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="css/index.css">
  <script src="https://cdn.jsdelivr.net/npm/intersection-observer@0.7.0/intersection-observer.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload@19.1.3/dist/lazyload.min.js"></script>
  <title>Qiang Wang</title>
</head>

<body>
  <header id="info">
    <h1>Qiang Wang</h1>
    <h2>itsqiangwang@gmail.com</h2>
    <h3>Graphic Design, etc.</h3>
  </header>
  <!--
        https://github.com/verlok/vanilla-lazyload
    -->
  <script type="text/javascript">
    var lazyLoadInstance = new LazyLoad({});

    // Select all figures, nav items, header, and footer
    const figures = document.querySelectorAll('figure');
    const navItems = document.querySelectorAll('nav ul li');
    const header = document.querySelector('header');
    const footer = document.querySelector('footer');

    // Function to highlight nav item based on figcaption in view
    function highlightNavItem() {
      let isNavUpdated = false;  // Track if any nav item has been updated

      // Get header and footer positions
      const headerRect = header.getBoundingClientRect();
      const footerRect = footer.getBoundingClientRect();

      // Check if header or footer is in view
      const isHeaderVisible = headerRect.bottom > 0 && headerRect.top < window.innerHeight;
      const isFooterVisible = footerRect.top < window.innerHeight && footerRect.bottom > 0;

      // If header or footer is visible, remove all active classes and stop
      if (isHeaderVisible || isFooterVisible) {
        navItems.forEach(item => item.classList.remove('active'));
        return;  // Exit the function early
      }

      // Loop through each figure and check if the figcaption is in view
      figures.forEach((figure, index) => {
        const figcaption = figure.querySelector('figcaption');
        const rect = figcaption.getBoundingClientRect();

        // Check if the figcaption is fully or mostly visible in the viewport
        if (rect.top >= 0 && rect.bottom <= window.innerHeight) {
          // Remove active class from all nav items
          navItems.forEach(item => item.classList.remove('active'));
          // Add active class to the corresponding nav item
          navItems[index].classList.add('active');
          isNavUpdated = true;  // Mark that a nav item has been updated
        }
      });

      // If no figcaption is fully in view, deactivate all nav items
      if (!isNavUpdated) {
        navItems.forEach(item => item.classList.remove('active'));
      }
    }

    // Add scroll event listener
    window.addEventListener('scroll', highlightNavItem);

    // Initial check on page load
    highlightNavItem();
  </script>
</body>

</html>